jQuery(document).on('turbolinks:load', function () {
    var messages, messages_to_bottom;
    messages = $('#group_posts');
    if ($('#group_posts').length > 0) {
        messages_to_bottom = function () {
            return messages.scrollTop(messages.prop("scrollHeight"));
        };
        messages_to_bottom();
        console.log("Group.coffee");
        App.groups = App.cable.subscriptions.create("GroupChannel", {
            collection: function () {
                return $("[data-channel='new_group']");
            },
            connected: function () {
                console.log("group Connected");
                console.log("messages:", messages);
                console.log("messages.data", messages.data);
                console.log(messages.data('group-id'));
                return setTimeout((function (_this) {
                    return function () {
                        return _this.followCurrentMessage();
                    };
                })(this));
            },
            disconnected: function () {
                return console.log("group Disconnected");
            },
            received: function (data) {
                console.log("Data:", data);
                messages.append(data['message']);
                return messages_to_bottom();
            },
            followCurrentMessage: function () {
                var groupId;
                if (groupId = this.collection().data('group-id')) {
                    return this.perform('follow', {
                        group_id: groupId
                    });
                } else {
                    return this.perform('unfollow');
                }
            },
            send_message: function (message, chat_room_id) {
                return this.perform('send_message', {
                    message: message,
                    chat_room_id: chat_room_id
                });
            }
        });
    }
    return $('#new_message').submit(function (e) {
        var $this, textarea;
        $this = $(this);
        textarea = $this.find('#message_body');
        if ($.trim(textarea.val()).length > 1) {
            App.groups.send_message(textarea.val(), messages.data('group-id'));
            textarea.val('');
        }
        e.preventDefault();
        return false;
    });
});

// ---
// generated by coffee-script 1.9.2